<script>
// called when the "draw flashcard" button is pressed
function drawFlashcard() {
  // create a new AJAX request object
  var xhttp = new XMLHttpRequest();
  // tell the request object that when its state changes, it should check if it good a good reply back, and then call populateFlashcard
  xhttp.onreadystatechange = function() {
    // readyState == 4 if response received. status == 200 if server gave back a good response
    if (this.readyState == 4 && this.status == 200) {
     populateFlashcard(this.responseText)
    }
  };
  // prepare to send the AJAX request to courses/flashcard
  xhttp.open("GET", '<%= url_for(controller: 'courses', action: 'flashcard') %>', true);
  // send the ajax request
  xhttp.send();
}

function populateFlashcard(json) {
  // if the json is not empty
  if (json != "{}"){
    // parse the returned JSON
    var student = JSON.parse(json);
    // populate the fields
    document.getElementById("student-name").innerHTML = student.name;
    document.getElementById("student-info").innerHTML = student.email;
    document.getElementById("student-picture").src = student.portrait_url;
    document.getElementById("student-picture").alt = student.name;
  }
}
</script>

<%= javascript_include_tag "dropzone.js" %>

<center>
  <br>
    <div>
      <h1> <%= @course.code %>: <%= @course.title %></h1>
      <ul class="nav nav-pills nav-justified">
        <li class = "active"><%= link_to "Course", user_course_path(@user, @course) %><br></li>
        <li><%= link_to "Edit Course", edit_user_course_path(@user, @course) %><br></li>
        <li><%= link_to "Student Roster", user_course_students_path(@user, @course) %><br></li>
      </ul>
      <div class = "container">
        <div class="row">
          <div class = "col-lg-4"></div>
            <div class = "col-lg-4">
            <h3>Flashcards</h3>
              <div class = "flashcard" id="flashcard-info">
                <%= image_tag "/images/defaults/flashcard/missing.png", :id => "student-picture", :style => "width:300px;height:300px;" %>
                <h4 id="student-name">Name</h4>
                <p id="student-info">info</p>
              </div>
              <button type="button" class ="btn" onclick="drawFlashcard()">Draw Flashcard</button>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-10 offset-lg-1">
            <h4>Import Students</h4>
            <%= form_tag import_user_course_students_path(@user, @course), class: "dropzone", multipart: true do %>
              <%= submit_tag "Import Students" %>
            <% end %>
          </div>
        </div>
        <div class="row">
          <h1>Student Roster</h1>
          <table>
            <tbody>
              <% @course.students.each do |student| %>
                <tr>
                  <td><%= image_tag student.portrait.url(:small)%></td>
                  <td><%= student.name %></td>
                  <td><%= link_to "See Student", user_course_student_path(@user, @course, student) %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
          </div>
        </div>
      </div>
    </div>
  </br>
</center>
